<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Fit Non-negative Matrix Factorization to Count Data — fit_poisson_nmf • fastTopics</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Fit Non-negative Matrix Factorization to Count Data — fit_poisson_nmf"><meta property="og:description" content="Approximate the input matrix X by the
  non-negative matrix factorization tcrossprod(L,F), in which
  the quality of the approximation is measured by a
  &amp;#8220;divergence&amp;#8221; criterion; equivalently, optimize the
  likelihood under a Poisson model of the count data, X, in
  which the Poisson rates are given by tcrossprod(L,F).
  Function fit_poisson_nmf runs a specified number of
  coordinate-wise updates to fit the L and F matrices."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">fastTopics</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.6-175</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/stephenslab/fastTopics" class="external-link">Source</a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fit Non-negative Matrix Factorization to Count Data</h1>
    <small class="dont-index">Source: <a href="https://github.com/stephenslab/fastTopics/blob/HEAD/R/fit_poisson_nmf.R" class="external-link"><code>R/fit_poisson_nmf.R</code></a>, <a href="https://github.com/stephenslab/fastTopics/blob/HEAD/R/init_poisson_nmf.R" class="external-link"><code>R/init_poisson_nmf.R</code></a></small>
    <div class="hidden name"><code>fit_poisson_nmf.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Approximate the input matrix <code>X</code> by the
  non-negative matrix factorization <code>tcrossprod(L,F)</code>, in which
  the quality of the approximation is measured by a
  “divergence” criterion; equivalently, optimize the
  likelihood under a Poisson model of the count data, <code>X</code>, in
  which the Poisson rates are given by <code>tcrossprod(L,F)</code>.
  Function <code>fit_poisson_nmf</code> runs a specified number of
  coordinate-wise updates to fit the L and F matrices.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">fit_poisson_nmf</span><span class="op">(</span></span>
<span>  <span class="va">X</span>,</span>
<span>  <span class="va">k</span>,</span>
<span>  <span class="va">fit0</span>,</span>
<span>  numiter <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  update.factors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  update.loadings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"scd"</span>, <span class="st">"em"</span>, <span class="st">"mu"</span>, <span class="st">"ccd"</span><span class="op">)</span>,</span>
<span>  init.method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"topicscore"</span>, <span class="st">"random"</span><span class="op">)</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"progressbar"</span>, <span class="st">"detailed"</span>, <span class="st">"none"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">fit_poisson_nmf_control_default</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">init_poisson_nmf</span><span class="op">(</span></span>
<span>  <span class="va">X</span>,</span>
<span>  <span class="cn">F</span>,</span>
<span>  <span class="va">L</span>,</span>
<span>  <span class="va">k</span>,</span>
<span>  init.method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"topicscore"</span>, <span class="st">"random"</span><span class="op">)</span>,</span>
<span>  beta <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  betamax <span class="op">=</span> <span class="fl">0.99</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"detailed"</span>, <span class="st">"none"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">init_poisson_nmf_from_clustering</span><span class="op">(</span><span class="va">X</span>, <span class="va">clusters</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>X</dt>
<dd><p>The n x m matrix of counts; all entries of X should be
non-negative. It can be a sparse matrix (class <code>"dgCMatrix"</code>)
or dense matrix (class <code>"matrix"</code>), with some exceptions (see
‘Details’).</p></dd>


<dt>k</dt>
<dd><p>An integer 2 or greater giving the matrix rank. This
argument should only be specified if the initial fit (<code>fit0</code>
or <code>F, L</code>) is not provided.</p></dd>


<dt>fit0</dt>
<dd><p>The initial model fit. It should be an object of class
“poisson_nmf_fit”, such as an output from
<code>init_poisson_nmf</code>, or from a previous call to
<code>fit_poisson_nmf</code>.</p></dd>


<dt>numiter</dt>
<dd><p>The maximum number of updates of the factors and
loadings to perform.</p></dd>


<dt>update.factors</dt>
<dd><p>A numeric vector specifying which factors
(rows of <code>F</code>) to update. By default, all factors are
updated. Note that the rows that are not updated may still change
by rescaling. When <code>NULL</code>, all factors are fixed. This option
is only implemented for <code>method = "em"</code> and <code>method =
"scd"</code>. If another method is selected, the default setting of
<code>update.factors</code> must be used.</p></dd>


<dt>update.loadings</dt>
<dd><p>A numeric vector specifying which loadings
(rows of <code>L</code>) to update. By default, all loadings are
updated. Note that the rows that are not updated may still change
by rescaling. When <code>NULL</code>, all loadings are fixed. This option
is only implemented for <code>method = "em"</code> and <code>method =
"scd"</code>. If another method is selected, the default setting of
<code>update.loadings</code> must be used.</p></dd>


<dt>method</dt>
<dd><p>The method to use for updating the factors and
loadings. Four methods are implemented: multiplicative updates,
<code>method = "mu"</code>; expectation maximization (EM), <code>method =
"em"</code>; sequential co-ordinate descent (SCD), <code>method = "scd"</code>;
and cyclic co-ordinate descent (CCD), <code>method = "ccd"</code>. See
‘Details’ for a detailed description of these methods.</p></dd>


<dt>init.method</dt>
<dd><p>The method used to initialize the factors and
loadings. When <code>init.method = "random"</code>, the factors and
loadings are initialized uniformly at random; when
<code>init.method = "topicscore"</code>, the factors are initialized
using the (very fast) Topic SCORE algorithm (Ke &amp; Wang, 2017), and
the loadings are initialized by running a small number of SCD
updates. This input argument is ignored if initial estimates of the
factors and loadings are already provided via input <code>fit0</code>, or
inputs <code>F</code> and <code>L</code>.</p></dd>


<dt>control</dt>
<dd><p>A list of parameters controlling the behaviour of
the optimization algorithm (and the Topic SCORE algorithm if it
is used to initialize the model parameters). See ‘Details’.</p></dd>


<dt>verbose</dt>
<dd><p>When <code>verbose = "detailed"</code>, information about
the algorithm's progress is printed to the console at each
iteration; when <code>verbose = "progressbar"</code>, a progress bar is
shown; and when <code>verbose = "none"</code>, no progress information is
printed. See the description of the “progress” return value
for an explanation of <code>verbose = "detailed"</code> console
output. (Note that some columns of the “progress” data frame
are not shown in the console output.)</p></dd>


<dt>F</dt>
<dd><p>An optional argument giving is the initial estimate of the
factors (also known as “basis vectors”). It should be an m x
k matrix, where m is the number of columns in the counts matrix
<code>X</code>, and k &gt; 1 is the rank of the matrix factorization
(equivalently, the number of “topics”). All entries of
<code>F</code> should be non-negative. When <code>F</code> and <code>L</code> are not
provided, input argument <code>k</code> should be specified instead.</p></dd>


<dt>L</dt>
<dd><p>An optional argument giving the initial estimate of the
loadings (also known as “activations”). It should be an n x k
matrix, where n is the number of rows in the counts matrix
<code>X</code>, and k &gt; 1 is the rank of the matrix factorization
(equivalently, the number of “topics”). All entries of
<code>L</code> should be non-negative. When <code>F</code> and <code>L</code> are not
provided, input argument <code>k</code> should be specified instead.</p></dd>


<dt>beta</dt>
<dd><p>Initial setting of the extrapolation parameter. This is
\(beta\) in Algorithm 3 of Ang &amp; Gillis (2019).</p></dd>


<dt>betamax</dt>
<dd><p>Initial setting for the upper bound on the
extrapolation parameter. This is \(\bar{\gamma}\) in Algorithm 3
of Ang &amp; Gillis (2019).</p></dd>


<dt>clusters</dt>
<dd><p>A factor specifying a grouping, or clustering, of
the rows of <code>X</code>.</p></dd>


<dt>...</dt>
<dd><p>Additional arguments passed to <code>init_poisson_nmf</code>.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p><code>init_poisson_nmf</code> and <code>fit_poisson_nmf</code> both
return an object capturing the optimization algorithm state (for
<code>init_poisson_nmf</code>, this is the initial state). It is a list
with the following elements:</p>
<dl><dt>F</dt>
<dd><p>A matrix containing the current best estimates of the
  factors.</p></dd>


<dt>L</dt>
<dd><p>A matrix containing the current best estimates of the
  loadings.</p></dd>


<dt>Fn</dt>
<dd><p>A matrix containing the non-extrapolated factor estimates.
  If extrapolation is not used, <code>Fn</code> and <code>F</code> will be the
  same.</p></dd>


<dt>Ln</dt>
<dd><p>A matrix containing the non-extrapolated estimates of the
  loadings. If extrapolation is not used, <code>Ln</code> and <code>L</code> will
  be the same.</p></dd>


<dt>Fy</dt>
<dd><p>A matrix containing the extrapolated factor estimates. If
  the extrapolation scheme is not used, <code>Fy</code> and <code>F</code> will
  be the same.</p></dd>


<dt>Ly</dt>
<dd><p>A matrix containing the extrapolated estimates of the
  loadings. If extrapolation is not used, <code>Ly</code> and <code>L</code> will
  be the same.</p></dd>


<dt>loss</dt>
<dd><p>Value of the objective (“loss”) function
  computed at the current best estimates of the factors and
  loadings.</p></dd>


<dt>loss.fnly</dt>
<dd><p>Value of the objective (“loss”) function
  computed at the extrapolated solution for the loadings (<code>Ly</code>)
  and the non-extrapolated solution for the factors (<code>Fn</code>). This
  is used internally to implement the extrapolated updates.</p></dd>


<dt>iter</dt>
<dd><p>The number of the most recently completed iteration.</p></dd>


<dt>beta</dt>
<dd><p>The extrapolation parameter, \(beta\) in Algorithm 3
  of Ang &amp; Gillis (2019).</p></dd>


<dt>betamax</dt>
<dd><p>Upper bound on the extrapolation parameter. This is
  \(\bar{\gamma}\) in Algorithm 3 of Ang &amp; Gillis (2019).</p></dd>


<dt>beta0</dt>
<dd><p>The setting of the extrapolation parameter at the
  last iteration that improved the solution.</p></dd>


<dt>progress</dt>
<dd><p>A data frame containing detailed information about
  the algorithm's progress. The data frame should have at most
  <code>numiter</code>
  rows. The columns of the data frame are: “iter”, the
  iteration number; “loglik”, the Poisson NMF log-likelihood
  at the current best factor and loading estimates;
  “loglik.multinom”, the multinomial topic model
  log-likelihood at the current best factor and loading estimates;
  “dev”, the deviance at the current best factor and loading
  estimates; “res”, the maximum residual of the
  Karush-Kuhn-Tucker (KKT) first-order optimality conditions at the
  current best factor and loading estimates; “delta.f”, the
  largest change in the factors matrix; “delta.l”, the largest
  change in the loadings matrix; “nonzeros.f”, the proportion
  of entries in the factors matrix that are nonzero;
  “nonzeros.l”, the proportion of entries in the loadings
  matrix that are nonzero; “extrapolate”, which is 1 if
  extrapolation is used, otherwise it is 0; “beta”, the
  setting of the extrapolation parameter; “betamax”, the
  setting of the extrapolation parameter upper bound; and
  “timing”, the elapsed time in seconds (recorded using
  <code><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></code>).</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>In Poisson non-negative matrix factorization (Lee &amp; Seung,
2001), counts \(x_{ij}\) in the \(n \times m\) matrix, \(X\),
are modeled by the Poisson distribution: $$x_{ij} \sim
\mathrm{Poisson}(\lambda_{ij}).$$ Each Poisson rate,
\(\lambda_{ij}\), is a linear combination of parameters
\(f_{jk} \geq 0, l_{ik} \geq 0\) to be fitted to the data:
$$\lambda_{ij} = \sum_{k=1}^K l_{ik} f_{jk},$$ in which \(K\)
is a user-specified tuning parameter specifying the rank of the
matrix factorization. Function <code>fit_poisson_nmf</code> computes
maximum-likelihood estimates (MLEs) of the parameters. For
additional mathematical background, and an explanation of how
Poisson NMF is connected to topic modeling, see the vignette:
<code><a href="../articles/relationship.html">vignette(topic = "relationship",package = "fastTopics")</a></code>.</p>
<p>Using this function requires some care; only minimal argument
checking is performed, and error messages may not be helpful.</p>
<p>The EM and multiplicative updates are simple and fast, but can be
slow to converge to a stationary point. When <code>control$numiter
= 1</code>, the EM and multiplicative updates are mathematically
equivalent to the multiplicative updates, and therefore share the
same convergence properties. However, the implementation of the EM
updates is quite different; in particular, the EM updates are more
suitable for sparse counts matrices. The implementation of the
multiplicative updates is adapted from the MATLAB code by Daichi
Kitamura <a href="http://d-kitamura.net" class="external-link">http://d-kitamura.net</a>.</p>
<p>Since the multiplicative updates are implemented using standard
matrix operations, the speed is heavily dependent on the
BLAS/LAPACK numerical libraries used. In particular, using
optimized implementations such as OpenBLAS or Intel MKL can result
in much improved performance of the multiplcative updates.</p>
<p>The cyclic co-ordinate descent (CCD) and sequential co-ordinate
descent (SCD) updates adopt the same optimization strategy, but
differ in the implementation details. In practice, we have found
that the CCD and SCD updates arrive at the same solution when
initialized “sufficiently close” to a stationary point. The
CCD implementation is adapted from the C++ code developed by
Cho-Jui Hsieh and Inderjit Dhillon, which is available for download
at <a href="https://www.cs.utexas.edu/~cjhsieh/nmf/" class="external-link">https://www.cs.utexas.edu/~cjhsieh/nmf/</a>. The SCD
implementation is based on version 0.4-3 of the ‘NNLM’
package.</p>
<p>An additional re-scaling step is performed after each update to
promote numerical stability.</p>
<p>We use three measures of progress for the model fitting: (1)
improvement in the log-likelihood (or deviance), (2) change in the
model parameters, and (3) the residuals of the Karush-Kuhn-Tucker
(KKT) first-order conditions. As the iterates approach a stationary
point of the loss function, the change in the model parameters
should be small, and the residuals of the KKT system should vanish.
Use <code><a href="plot_progress.html">plot_progress</a></code> to plot the improvement in the
solution over time.</p>
<p>See <code><a href="fit_topic_model.html">fit_topic_model</a></code> for additional guidance on model
fitting, particularly for large or complex data sets.</p>
<p>The <code>control</code> argument is a list in which any of the
following named components will override the default optimization
algorithm settings (as they are defined by
<code>fit_poisson_nmf_control_default</code>):</p>
<dl><dt><code>numiter</code></dt>
<dd><p>Number of “inner loop” iterations to
  run when performing and update of the factors or loadings. This
  must be set to 1 for <code>method = "mu"</code> and <code>method =
  "ccd"</code>.</p></dd>


<dt><code>nc</code></dt>
<dd><p>Number of RcppParallel threads to use for the
  updates. When <code>nc</code> is <code>NA</code>, the number of threads is
  determined by calling
  <code><a href="https://rdrr.io/pkg/RcppParallel/man/setThreadOptions.html" class="external-link">defaultNumThreads</a></code>. This setting is
  ignored for the multiplicative upates (<code>method = "mu"</code>).</p></dd>


<dt><code>nc.blas</code></dt>
<dd><p>Number of threads used in the numerical
  linear algebra library (e.g., OpenBLAS), if available. For best
  performance, we recommend setting this to 1 (i.e., no
  multithreading).</p></dd>


<dt><code>min.delta.loglik</code></dt>
<dd><p>Stop performing updates if the
  difference in the Poisson NMF log-likelihood between two successive
  updates is less than <code>min.delta.loglik</code>. This should not be
  kept at zero when <code>control$extrapolate = TRUE</code> because the
  extrapolated updates are expected to occasionally keep the
  likelihood unchanged. Ignored if <code>min.delta.loglik &lt; 0</code>.</p></dd>


<dt><code>min.res</code></dt>
<dd><p>Stop performing updates if the maximum KKT
  residual is less than <code>min.res</code>. Ignored if <code>min.res &lt; 0</code>.</p></dd>


<dt><code>minval</code></dt>
<dd><p>A small, positive constant used to safeguard
  the multiplicative updates. The safeguarded updates are implemented
  as <code>F &lt;- pmax(F1,minval)</code> and <code>L &lt;- pmax(L1,minval)</code>,
  where <code>F1</code> and <code>L1</code> are the factors and loadings matrices
  obtained by applying an update. This is motivated by Theorem 1 of
  Gillis &amp; Glineur (2012). Setting <code>minval = 0</code> is allowed, but
  some methods are not guaranteed to converge to a stationary point
  without this safeguard, and a warning will be given in this case.</p></dd>


<dt><code>extrapolate</code></dt>
<dd><p>When <code>extrapolate = TRUE</code>, the
  extrapolation scheme of Ang &amp; Gillis (2019) is used.</p></dd>


<dt><code>extrapolate.reset</code></dt>
<dd><p>To promote better numerical
  stability of the extrapolated updates, they are “reset”
  every so often. This parameter determines the number of iterations
  to wait before resetting.</p></dd>


<dt><code>beta.increase</code></dt>
<dd><p>When the extrapolated update improves
  the solution, scale the extrapolation parameter by this amount.</p></dd>


<dt><code>beta.reduce</code></dt>
<dd><p>When the extrapolaaed update does not
  improve the solution, scale the extrapolation parameter by this
  amount.</p></dd>


<dt><code>betamax.increase</code></dt>
<dd><p>When the extrapolated update
  improves the solution, scale the extrapolation parameter by this
  amount.</p></dd>


<dt><code>eps</code></dt>
<dd><p>A small, non-negative number that is added to the
  terms inside the logarithms to sidestep computing logarithms of
  zero. This prevents numerical problems at the cost of introducing a
  small inaccuracy in the solution. Increasing this number may lead
  to faster convergence but possibly a less accurate solution.</p></dd>


<dt><code>zero.threshold</code></dt>
<dd><p>A small, non-negative number used to
  determine which entries of the solution are exactly zero. Any
  entries that are less than or equal to <code>zero.threshold</code> are
  considered to be exactly zero.</p></dd>

</dl><p>An additional setting, <code>control$init.numiter</code>, controls the
number of sequential co-ordinate descent (SCD) updates that are
performed to initialize the loadings matrix when <code>init.method
= "topicscore"</code>.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Ang, A. and Gillis, N. (2019). Accelerating nonnegative matrix
  factorization algorithms using extrapolation. <em>Neural
  Computation</em> <b>31</b>, 417–439.</p>
<p>Cichocki, A., Cruces, S. and Amari, S. (2011). Generalized
  alpha-beta divergences and their application to robust nonnegative
  matrix factorization. <em>Entropy</em> <b>13</b>, 134–170.</p>
<p>Gillis, N. and Glineur, F. (2012). Accelerated multiplicative
  updates and hierarchical ALS algorithms for nonnegative matrix
  factorization. <em>Neural Computation</em> <code>24</code>, 1085–1105.</p>
<p>Hsieh, C.-J. and Dhillon, I. (2011). Fast coordinate descent
  methods with variable selection for non-negative matrix
  factorization. In <em>Proceedings of the 17th ACM SIGKDD
  international conference on Knowledge discovery and data mining</em>,
  p. 1064-1072</p>
<p>Lee, D. D. and Seung, H. S. (2001). Algorithms for non-negative
  matrix factorization. In <em>Advances in Neural Information
  Processing Systems</em> <b>13</b>, 556–562.</p>
<p>Lin, X. and Boutros, P. C. (2018). Optimization and expansion of
  non-negative matrix factorization. <em>BMC Bioinformatics</em>
  <b>21</b>, 7.</p>
<p>Ke, Z. &amp; Wang, M. (2017). A new SVD approach to optimal topic
  estimation. <em>arXiv</em> <a href="https://arxiv.org/abs/1704.07016" class="external-link">https://arxiv.org/abs/1704.07016</a></p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="fit_topic_model.html">fit_topic_model</a></code>, <code><a href="plot_progress.html">plot_progress</a></code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Simulate a (sparse) 80 x 100 counts matrix.</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://Matrix.R-forge.R-project.org" class="external-link">Matrix</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="simulate_count_data.html">simulate_count_data</a></span><span class="op">(</span><span class="fl">80</span>,<span class="fl">100</span>,k <span class="op">=</span> <span class="fl">3</span>,sparse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">$</span><span class="va">X</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Remove columns (words) that do not appear in any row (document).</span></span></span>
<span class="r-in"><span><span class="va">X</span> <span class="op">&lt;-</span> <span class="va">X</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">X</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Run 10 EM updates to find a good initialization.</span></span></span>
<span class="r-in"><span><span class="va">fit0</span> <span class="op">&lt;-</span> <span class="fu">fit_poisson_nmf</span><span class="op">(</span><span class="va">X</span>,k <span class="op">=</span> <span class="fl">3</span>,numiter <span class="op">=</span> <span class="fl">10</span>,method <span class="op">=</span> <span class="st">"em"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Initializing factors using Topic SCORE algorithm.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Initializing loadings by running 10 SCD updates.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fitting rank-3 Poisson NMF to 80 x 100 sparse matrix.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Running at most 10 EM updates, without extrapolation (fastTopics 0.6-175).</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Fit the Poisson NMF model by running 50 EM updates.</span></span></span>
<span class="r-in"><span><span class="va">fit_em</span> <span class="op">&lt;-</span> <span class="fu">fit_poisson_nmf</span><span class="op">(</span><span class="va">X</span>,fit0 <span class="op">=</span> <span class="va">fit0</span>,numiter <span class="op">=</span> <span class="fl">50</span>,method <span class="op">=</span> <span class="st">"em"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fitting rank-3 Poisson NMF to 80 x 100 sparse matrix.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Running at most 50 EM updates, without extrapolation (fastTopics 0.6-175).</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [===============================================&gt;-----------------------]  68%</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [=================================================&gt;---------------------]  70%</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [==================================================&gt;--------------------]  72%</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [====================================================&gt;------------------]  74%</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [=====================================================&gt;-----------------]  76%</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [======================================================&gt;----------------]  78%</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [========================================================&gt;--------------]  80%</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [=========================================================&gt;-------------]  82%</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [===========================================================&gt;-----------]  84%</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [============================================================&gt;----------]  86%</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [=============================================================&gt;---------]  88%</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [===============================================================&gt;-------]  90%</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [================================================================&gt;------]  92%</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [==================================================================&gt;----]  94%</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [===================================================================&gt;---]  96%</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [=====================================================================&gt;-]  98%</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [=======================================================================] 100%</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>                                                                               </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Fit the Poisson NMF model by running 50 extrapolated SCD updates.</span></span></span>
<span class="r-in"><span><span class="va">fit_scd</span> <span class="op">&lt;-</span> <span class="fu">fit_poisson_nmf</span><span class="op">(</span><span class="va">X</span>,fit0 <span class="op">=</span> <span class="va">fit0</span>,numiter <span class="op">=</span> <span class="fl">50</span>,method <span class="op">=</span> <span class="st">"scd"</span>,</span></span>
<span class="r-in"><span>                           control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>extrapolate <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fitting rank-3 Poisson NMF to 80 x 100 sparse matrix.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Running at most 50 SCD updates, with extrapolation (fastTopics 0.6-175).</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [====================================&gt;----------------------------------]  52%</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [=====================================&gt;---------------------------------]  54%</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [=======================================&gt;-------------------------------]  56%</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [========================================&gt;------------------------------]  58%</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [==========================================&gt;----------------------------]  60%</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [===========================================&gt;---------------------------]  62%</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [============================================&gt;--------------------------]  64%</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [==============================================&gt;------------------------]  66%</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [===============================================&gt;-----------------------]  68%</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [=================================================&gt;---------------------]  70%</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [==================================================&gt;--------------------]  72%</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [====================================================&gt;------------------]  74%</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [=====================================================&gt;-----------------]  76%</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [======================================================&gt;----------------]  78%</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [========================================================&gt;--------------]  80%</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [=========================================================&gt;-------------]  82%</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [===========================================================&gt;-----------]  84%</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [============================================================&gt;----------]  86%</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [=============================================================&gt;---------]  88%</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [===============================================================&gt;-------]  90%</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [================================================================&gt;------]  92%</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [==================================================================&gt;----]  94%</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [===================================================================&gt;---]  96%</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [=====================================================================&gt;-]  98%</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [=======================================================================] 100%</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>                                                                               </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Compare the two fits.</span></span></span>
<span class="r-in"><span><span class="va">fits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>em <span class="op">=</span> <span class="va">fit_em</span>,scd <span class="op">=</span> <span class="va">fit_scd</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="compare_fits.html">compare_fits</a></span><span class="op">(</span><span class="va">fits</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     k loglik  dev loglik.diff dev.diff        res nonzeros.f nonzeros.l numiter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> em  3  -8316 7720       0.000    0.000 0.18213738     0.8533     0.8875      60</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> scd 3  -8312 7711       4.435    8.871 0.00001283     0.8767     0.8167      60</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     runtime</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> em    0.289</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> scd   0.371</span>
<span class="r-in"><span><span class="fu"><a href="plot_progress.html">plot_progress</a></span><span class="op">(</span><span class="va">fits</span>,y <span class="op">=</span> <span class="st">"loglik"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="fit_poisson_nmf-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="plot_progress.html">plot_progress</a></span><span class="op">(</span><span class="va">fits</span>,y <span class="op">=</span> <span class="st">"res"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="fit_poisson_nmf-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Recover the topic model. After this step, the L matrix contains the</span></span></span>
<span class="r-in"><span><span class="co"># mixture proportions ("loadings"), and the F matrix contains the</span></span></span>
<span class="r-in"><span><span class="co"># word frequencies ("factors").</span></span></span>
<span class="r-in"><span><span class="va">fit_multinom</span> <span class="op">&lt;-</span> <span class="fu"><a href="poisson2multinom.html">poisson2multinom</a></span><span class="op">(</span><span class="va">fit_scd</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Peter Carbonetto, Kevin Luo, Kushal Dey, Matthew Stephens.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

